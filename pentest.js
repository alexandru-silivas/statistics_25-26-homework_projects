// pentest.js â€” Fixed random-walk simulations for Homework 7

function simulateTrajectory(weeks, attackers, p) {
  const s = Math.pow(1 - p, attackers);
  let score = 0;
  const cumul = [];
  for (let i = 0; i < weeks; i++) {
    const secure = Math.random() < s;
    score += secure ? 1 : -1;
    cumul.push(score);
  }
  return cumul;
}

function createChart(ctx, data, color = 'rgba(78,163,255,0.95)') {
  return new Chart(ctx, {
    type: 'line',
    data: {
      labels: Array.from({ length: data.length }, (_, i) => i + 1),
      datasets: [
        {
          label: 'Score over time',
          data: data,
          borderColor: color,
          fill: false,
          tension: 0.25,
          borderWidth: 2
        }
      ]
    },
    options: {
      animation: { duration: 600 },
      scales: {
        x: { title: { display: true, text: 'Week' }, min: 1, max: 50 },
        y: { title: { display: true, text: 'Score' }, min: -50, max: 50 }
      },
      plugins: {
        legend: { display: false }
      }
    }
  });
}

function drawAll() {
  // Parameters fixed:
  const weeks = 50;
  const p = 0.05;

  // Graph 1: 1 attacker
  const t1 = simulateTrajectory(weeks, 1, p);
  createChart(document.getElementById('walk1').getContext('2d'), t1, 'rgba(78,163,255,0.95)');

  // Graph 2: 50 attackers
  const t2 = simulateTrajectory(weeks, 50, p);
  createChart(document.getElementById('walk2').getContext('2d'), t2, 'rgba(255,140,0,0.95)');

  // Graph 3: 500 trials of 50-week walks with 50 attackers
  const ctx3 = document.getElementById('walk3').getContext('2d');
  const datasets = [];
  for (let i = 0; i < 500; i++) {
    const t = simulateTrajectory(weeks, 50, p);
    datasets.push({
      data: t,
      borderColor: 'rgba(180,180,180,0.2)',
      borderWidth: 1,
      fill: false,
      tension: 0.2
    });
  }
  new Chart(ctx3, {
    type: 'line',
    data: { labels: Array.from({ length: weeks }, (_, i) => i + 1), datasets },
    options: {
      animation: { duration: 0 },
      scales: {
        x: { title: { display: true, text: 'Week' }, min: 1, max: 50 },
        y: { title: { display: true, text: 'Score' }, min: -50, max: 50 }
      },
      plugins: { legend: { display: false } }
    }
  });
}

window.addEventListener('load', drawAll);
