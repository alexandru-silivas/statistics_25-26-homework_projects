<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Homework 6 — Online Mean & Variance (Derivations, Implementation, Tests)</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- NAVBAR -->
  <header class="navbar">
    <nav>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="homework_1.html">HMWK 1</a></li>
        <li><a href="homework_2.html">HMWK 2</a></li>
        <li><a href="homework_3.html">HMWK 3</a></li>
        <li><a href="homework_4.html">HMWK 4</a></li>
        <li><a href="homework_5.html">HMWK 5</a></li>
        <li><a href="homework_6.html" class="active">HMWK 6</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <div class="main-content">
      <h1>Homework 6</h1>
      <hr class="section-separator">
      <h2>Derivations, Online Algorithms & Tests</h2>

      <h3>1. Recurrence for the Arithmetic Mean (simple proof)</h3>
      <p>
        Let <em>μₙ</em> denote the mean after observing <em>n</em> values x₁,...,xₙ:
      </p>
      <pre><code class="math">
μₙ = (x₁ + x₂ + ... + xₙ) / n
μₙ₋₁ = (x₁ + x₂ + ... + xₙ₋₁) / (n-1)
      </code></pre>
      <p>We can express μₙ in terms of μₙ₋₁:</p>
      <pre><code class="math">
μₙ = ( (n−1)·μₙ₋₁ + xₙ ) / n
    = μₙ₋₁ + (xₙ − μₙ₋₁) / n
      </code></pre>
      <p>
        This gives the online recurrence:
        <strong>μ ← μ + (x − μ) / n</strong>,
        which updates the mean in constant time using only the previous mean and the new value.
      </p>

      <h3>2. Recurrence for Variance (Welford’s derivation)</h3>
      <p>
        Define M₂ₙ = Σ<sub>i=1..n</sub> (xᵢ − μₙ)² (the sum of squared deviations from the current mean).
        The sample variance is M₂ₙ / n (or M₂ₙ / (n−1) for unbiased estimate).
      </p>
      <p>Welford’s online update avoids computing differences from a moving mean directly:</p>
      <pre><code class="math">
Given previous mean μₙ₋₁ and previous M2ₙ₋₁, for new xₙ:

1) δ = xₙ − μₙ₋₁
2) μₙ = μₙ₋₁ + δ / n
3) M2ₙ = M2ₙ₋₁ + δ * (xₙ − μₙ)

Note: step 3 can be written as M2ₙ = M2ₙ₋₁ + δ * δ2 where δ2 = xₙ − μₙ
      </code></pre>
      <p>
        <em>Why this works (sketch):</em> expand the squared deviations and rearrange terms to isolate
        the previous M<sub>2</sub> plus the incremental correction δ·(xₙ − μₙ). This update is numerically stable
        because it avoids subtracting two large nearly-equal sums, which is the source of catastrophic cancellation.
      </p>

      <h3>3. Numerical Stability — Why Welford wins</h3>
      <p>
        Traditional "batch" formulas (compute mean, then compute Σ(x−mean)²) are:
        - <strong>Memory intensive</strong> (need all data), and
        - Prone to <strong>round-off error</strong> when numbers are large or when variance is small relative
          to mean (catastrophic cancellation).
      </p>
      <p>
        <strong>Welford’s algorithm</strong> accumulates squared deviations incrementally and uses the two δ values
        (before/after updating the mean), which significantly reduces numerical error and requires constant memory.
      </p>

      <hr>

      <h3>4. Implementation (interactive demo + test harness)</h3>
      <p>
        Below is the interactive demo: add random values, inspect online mean & variance, and run automated tests
        comparing online vs batch (exact) computation on random datasets.
      </p>

      <section id="online-demo">
        <canvas id="onlineStatsChart"></canvas>

        <div style="margin-top:14px;" class="rsa-row">
          <button type="button" onclick="addRandomValue()">Add Random Value</button>
          <button type="button" onclick="resetData()">Reset</button>
          <button type="button" onclick="runTests()">Run Tests</button>
        </div>

        <p id="statsDisplay">No data yet.</p>
        <div id="testResults" style="margin-top:12px;color:var(--muted);font-size:0.95rem;"></div>
      </section>

      <h3>5. Test plan (what the harness does)</h3>
      <ol>
        <li>Generate small random datasets (sizes and distributions vary).</li>
        <li>Compute batch mean/variance and online mean/variance.</li>
        <li>Report absolute differences and maximum deviation across tests.</li>
      </ol>

      <h3>6. Implementation notes</h3>
      <ul>
        <li>We use population variance (M2 / n) in the demo. For unbiased sample variance use M2 / (n − 1).</li>
        <li>The test harness reports errors on the scale of floating point precision; Welford should match batch results closely.</li>
      </ul>

      <hr>
      <a href="homework_5.html" class="back-button">← Back to Homework 5</a>
    </div>
  </main>

  <footer class="site-footer">
    © 2025 Alexandru Silivas — ID 2252622 —
    <a href="mailto:silivas.2252622@studenti.uniroma1.it">silivas.2252622@studenti.uniroma1.it</a>
  </footer>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Homework 6 JS -->
  <script src="mean_variance_online.js"></script>
</body>
</html>
